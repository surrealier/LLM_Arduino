---
description: LLM_Arduino 프로젝트 핵심 개발 기준 및 아키텍처 원칙
alwaysApply: true
---

# LLM_Arduino 프로젝트 개발 기준

## 🔒 프로덕션 레벨 코드 품질 유지

### 절대 금지 사항

**❌ 단편적이고 임시방편적인 수정 금지**

```python
# ❌ 금지: 문제 있는 코드를 주석처리하고 넘어가기
# def problematic_function():
#     ...
# TODO: 나중에 고치기

# ❌ 금지: 불확실한 테스트성 수정
if True:  # 임시로 테스트
    pass

# ❌ 금지: 대량의 코드를 한 번에 수정
# 여러 파일, 여러 기능을 한 번에 변경하지 말 것
```

**✅ 올바른 접근 방식**

```python
# ✅ 올바름: 문제를 완전히 이해하고 근본적으로 해결
def fixed_function():
    """완전히 동작하는 구현"""
    # 명확한 로직
    return result

# ✅ 올바름: 단계적이고 점진적인 수정
# 1. 한 번에 하나의 기능만 수정
# 2. 각 수정 후 테스트
# 3. 확실한 변경만 적용
```

### 코드 변경 원칙

1. **완전성**: 모든 변경은 완전히 동작하는 상태여야 함
2. **점진성**: 한 번에 하나의 기능만 수정
3. **검증성**: 각 변경 후 반드시 테스트
4. **지속성**: 임시방편이 아닌 영구적 솔루션

## 🏗️ 서버-클라이언트 아키텍처

### 핵심 원칙: 서버 중심 설계

**서버(Python) 담당**
- ✅ 모든 비즈니스 로직
- ✅ 상태 관리
- ✅ 로깅 및 모니터링
- ✅ 에러 처리 및 복구
- ✅ 복잡한 데이터 처리
- ✅ AI/LLM 통신
- ✅ 외부 서비스 연동

**클라이언트(ESP32) 담당**
- ✅ 오디오 캡처 및 전송
- ✅ 오디오 재생
- ✅ LED 제어
- ✅ 서보 제어
- ✅ 간단한 상태 보고

```cpp
// ❌ ESP32에서 금지: 복잡한 로직
void complex_decision_making() {
    // AI 모델 호출, 복잡한 상태 관리 등
}

// ✅ ESP32의 올바른 역할: 단순 실행
void executeServerCommand(uint8_t cmd) {
    switch(cmd) {
        case CMD_LED_ON: led.on(); break;
        case CMD_SERVO_MOVE: servo.move(angle); break;
    }
}
```

### 로깅 전략

```python
# ✅ 서버에서 모든 로깅 수행
logger.info(f"ESP32 연결됨: {client_id}")
logger.debug(f"오디오 데이터 수신: {len(data)} bytes")
logger.error(f"처리 실패: {error}", exc_info=True)
```

```cpp
// ❌ ESP32에서 상세 로깅 금지
// Serial.println("Complex state: ...");

// ✅ 필수적인 디버그 정보만 간단히
Serial.println("READY");
```

## 📝 문서 유지 관리

### README 자동 업데이트 규칙

**모든 기능 변경 시 README.md 업데이트 필수**

- ✅ 새 기능 추가됨 → README 업데이트
- ✅ 기존 기능 수정됨 → README 업데이트
- ✅ 기능 제거됨 → README 업데이트
- ✅ API 변경됨 → README 업데이트
- ✅ 설정 변경됨 → README 업데이트

```markdown
# README.md 업데이트 체크리스트

- [ ] 기능 목록 업데이트
- [ ] 사용 방법 업데이트
- [ ] 설정 예시 업데이트
- [ ] API 문서 업데이트
- [ ] 의존성 정보 업데이트
```

## 🧪 연결 시 초기화 테스트

### 서버-클라이언트 연결 시마다 전체 동작 테스트

```python
# ✅ 연결 시 초기화 및 테스트 수행
async def on_client_connected(client):
    logger.info("클라이언트 연결 - 초기화 테스트 시작")
    
    # 1. LED 테스트
    await client.test_led()
    
    # 2. 서보 테스트
    await client.test_servo()
    
    # 3. 오디오 테스트
    await client.test_audio()
    
    # 4. 전체 통신 테스트
    await client.test_protocol()
    
    logger.info("초기화 테스트 완료 - 정상 동작")
```

## 📋 TODO List 관리

### 기능 구현 상태를 TODO.md로 관리

**모든 세부 기능은 TODO.md에 기록**

```markdown
# TODO.md 구조 예시

## 🚀 진행 중
- [ ] 감정 시스템 리팩토링
  - [x] 기본 감정 상태 정의
  - [ ] 감정 전환 로직
  - [ ] LED 표현 매핑

## ✅ 완료
- [x] WebSocket 연결 안정화
- [x] 오디오 버퍼 개선

## 📝 계획
- [ ] Home Assistant 연동
- [ ] 다국어 지원
```

**기능 추가/수정 시**
1. TODO.md에 항목 추가
2. 구현 진행하며 상태 업데이트
3. 완료 후 ✅ 완료 섹션으로 이동
4. README.md도 함께 업데이트

---

## 💡 요약

1. **절대 임시방편 금지** - 완전하고 견고한 구현만
2. **서버 중심** - ESP32는 단순하게, 서버에서 모든 제어
3. **문서 동기화** - 기능 변경 = README 업데이트
4. **초기화 테스트** - 매 연결마다 전체 동작 확인
5. **TODO 관리** - 모든 기능 구현 상태를 문서화
